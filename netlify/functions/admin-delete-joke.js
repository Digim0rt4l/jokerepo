const { getStore } = require("@netlify/blobs");
exports.handler=async(event,context)=>{try{const u=context&&context.clientContext&&context.clientContext.user;if(!u)return{statusCode:401,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Unauthorized"})};const body=event.body?JSON.parse(event.body):{};const id=(body&&body.id||"").trim();if(!id)return{statusCode:400,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Missing id"})};let store;try{store=getStore({name:"jokerepo"})}catch(e){return{statusCode:500,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Blobs not available to this function runtime yet. Confirm this deploy is live and Blobs is enabled for the site.",detail:String(e&&e.message||e)})}}const raw=await store.get("jokes",{type:"json"})||{};if(!raw[id])return{statusCode:404,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Not found"})};raw[id]={...raw[id],deleted:true,deletedAt:Date.now()};await store.set("jokes",raw,{type:"json"});return{statusCode:200,headers:{"content-type":"application/json"},body:JSON.stringify({ok:true})}}catch(e){return{statusCode:500,headers:{"content-type":"application/json"},body:JSON.stringify({error:String(e&&e.message||e)})}}};
