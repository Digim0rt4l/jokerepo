const { getStore } = require("@netlify/blobs");
exports.handler=async(event,context)=>{try{const u=context&&context.clientContext&&context.clientContext.user;if(!u)return{statusCode:401,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Unauthorized"})};const body=event.body?JSON.parse(event.body):{};const id=(body&&body.id||"").trim();if(!id)return{statusCode:400,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Missing id"})};const store=getStore({name:"joke-repo",siteID:process.env.NETLIFY_SITE_ID,token:process.env.NETLIFY_BLOBS_TOKEN});const raw=await store.get("all",{type:"json"})||{};if(!raw[id])return{statusCode:404,headers:{"content-type":"application/json"},body:JSON.stringify({error:"Not found"})};raw[id]={...raw[id],deleted:true,deletedAt:Date.now()};await store.set("all",raw,{type:"json"});return{statusCode:200,headers:{"content-type":"application/json"},body:JSON.stringify({ok:true})}}catch(e){return{statusCode:500,headers:{"content-type":"application/json"},body:JSON.stringify({error:String(e&&e.message||e)})}}};
